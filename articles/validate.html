<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Validation • papercheck</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Fira_Code-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Validation">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-160147578-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-160147578-1');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">papercheck</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9029</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/papercheck.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/scienceverse/papercheck/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Validation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/scienceverse/papercheck/blob/master/vignettes/validate.Rmd" class="external-link"><code>vignettes/validate.Rmd</code></a></small>
      <div class="d-none name"><code>validate.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/scienceverse/papercheck" class="external-link">papercheck</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>This is a demo of the workflow for module validation. We are still
piloting this workflow and it is likely to change.</p>
<div class="section level2">
<h2 id="validation-sample">Validation sample<a class="anchor" aria-label="anchor" href="#validation-sample"></a>
</h2>
<p>Set up the papers in your validation sample. You will need a
directory of XML files created by <code><a href="../reference/pdf2grobid.html">pdf2grobid()</a></code>. In this
example, we’ll set everything up in a temporary directory.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create validation directory in temp dir</span></span>
<span><span class="va">valdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"validate"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">valdir</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># copy built-in XML files to xml directory</span></span>
<span><span class="va">xmldir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">valdir</span>, <span class="st">"xml"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">xmldir</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">xmls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="../reference/demodir.html">demodir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"\\.xml$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">xmls</span>, <span class="va">xmldir</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE TRUE TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sample-data">Sample data<a class="anchor" aria-label="anchor" href="#sample-data"></a>
</h2>
<p>Create a data frame with info about each paper. One column must be
called “id” and contain paths to the xml files (relative to the
validation file location). Other possible columns are “table”, “report”,
and “traffic_light”, which should contain the expected values of those
items from the module you’re testing. If you want to check more than
just the first row of the text column from the return table, omit the
table column and use the method in the next section.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"xml"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">xmldir</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  table <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"faceresearch.org"</span>, <span class="st">"https://osf.io/mwzuq"</span>, <span class="st">"https://osf.io/pwtrh"</span><span class="op">)</span>,</span>
<span>  report <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">""</span>, <span class="fl">3</span><span class="op">)</span>, <span class="co"># this module has no report</span></span>
<span>  traffic_light <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"info"</span>, <span class="st">"info"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The code above has one inaccurate traffic light (“red”) for
demonstration purposes.</p>
</div>
<div class="section level2">
<h2 id="expected-table">Expected Table<a class="anchor" aria-label="anchor" href="#expected-table"></a>
</h2>
<p>If the tables returned by the module you’re validating can have more
than one row, or you want to check columns other than “text”, you will
need to add the expected values to a separate data frame. One column
must be “xml” to join it to the other table. The other columns should
have the same names as the columns returned by the module. You can omit
any columns and they will not be checked in the validation. Here, we
will only validate the text and header columns (making one mistake in
the header column for demonstration purposes).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sample</span><span class="op">$</span><span class="va">id</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"faceresearch.org"</span>, <span class="st">"stumbleupon.com"</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"https://osf.io/mwzuq"</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"https://osf.io/pwtrh"</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  header <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Participants"</span>, <span class="st">"Participants"</span>, </span>
<span>             <span class="st">"Methods"</span>, <span class="st">"Procedure"</span>, <span class="st">"Analysis"</span>,</span>
<span>             <span class="st">"Intro"</span>, <span class="st">"Attitude"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">expected</span></span>
<span><span class="co">#&gt;                 id                 text       header</span></span>
<span><span class="co">#&gt; 1 xml/eyecolor.xml     faceresearch.org Participants</span></span>
<span><span class="co">#&gt; 2 xml/eyecolor.xml      stumbleupon.com Participants</span></span>
<span><span class="co">#&gt; 3   xml/incest.xml https://osf.io/mwzuq      Methods</span></span>
<span><span class="co">#&gt; 4   xml/incest.xml https://osf.io/mwzuq    Procedure</span></span>
<span><span class="co">#&gt; 5   xml/incest.xml https://osf.io/mwzuq     Analysis</span></span>
<span><span class="co">#&gt; 6   xml/prereg.xml https://osf.io/pwtrh        Intro</span></span>
<span><span class="co">#&gt; 7   xml/prereg.xml https://osf.io/pwtrh     Attitude</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="run-validation">Run Validation<a class="anchor" aria-label="anchor" href="#run-validation"></a>
</h2>
<p>If you don’t include the expected results table, the table check will
just check the first result in the text column of the module results and
match it to the table column of your sample.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/validate.html">validate</a></span><span class="op">(</span><span class="st">"all-urls"</span>, <span class="va">sample</span>, path <span class="op">=</span> <span class="va">valdir</span><span class="op">)</span></span>
<span></span>
<span><span class="va">v</span></span></code></pre></div>
<p>If you include the expected results table, it will assess all the
data for matching the module results table.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/validate.html">validate</a></span><span class="op">(</span><span class="st">"all-urls"</span>, <span class="va">sample</span>, <span class="va">expected</span>, path <span class="op">=</span> <span class="va">valdir</span><span class="op">)</span></span>
<span></span>
<span><span class="va">v</span></span></code></pre></div>
<p>We can further explore any problems by looking at the sample and
returned tables.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># show rows where the traffic light check is false</span></span>
<span><span class="va">v</span><span class="op">$</span><span class="va">sample</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">tl_check</span><span class="op">)</span></span>
<span><span class="co">#&gt;           id                table report traffic_light report_ver tl_ver misses</span></span>
<span><span class="co">#&gt; 1 xml/prereg https://osf.io/pwtrh                  red              info      1</span></span>
<span><span class="co">#&gt;   false_alarms table_check report_check tl_check</span></span>
<span><span class="co">#&gt; 1            1       FALSE         TRUE    FALSE</span></span></code></pre></div>
<p>The table check is false, and there is one missing and one extra
result.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># show rows where the table check is false</span></span>
<span><span class="va">v</span><span class="op">$</span><span class="va">sample</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">table_check</span><span class="op">)</span></span>
<span><span class="co">#&gt;           id                table report traffic_light report_ver tl_ver misses</span></span>
<span><span class="co">#&gt; 1 xml/prereg https://osf.io/pwtrh                  red              info      1</span></span>
<span><span class="co">#&gt;   false_alarms table_check report_check tl_check</span></span>
<span><span class="co">#&gt; 1            1       FALSE         TRUE    FALSE</span></span></code></pre></div>
<p>You can view the validated results table for that paper…</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">v</span><span class="op">$</span><span class="va">table</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="st">"xml/prereg.xml"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] id     text   header</span></span>
<span><span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span></span></code></pre></div>
<p>…and compare it with the expected results.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expected</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="st">"xml/prereg.xml"</span><span class="op">)</span></span>
<span><span class="co">#&gt;               id                 text   header</span></span>
<span><span class="co">#&gt; 1 xml/prereg.xml https://osf.io/pwtrh    Intro</span></span>
<span><span class="co">#&gt; 2 xml/prereg.xml https://osf.io/pwtrh Attitude</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lisa DeBruine, Daniel Lakens.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
